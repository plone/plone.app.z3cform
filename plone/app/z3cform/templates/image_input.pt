<div tal:define="
       download_url view/download_url;
       exists python: view.value is not None;
       action view/action;
       allow_nochange view/allow_nochange;
       doc_type view/file_content_type;
       icon view/file_icon;
       filename view/filename;
     "
     tal:attributes="
       id view/id;
       style view/style;
       title view/title;
       lang view/lang;
       onclick view/onclick;
       ondblclick view/ondblclick;
       onmousedown view/onmousedown;
       onmouseup view/onmouseup;
       onmouseover view/onmouseover;
       onmousemove view/onmousemove;
       onmouseout view/onmouseout;
       onkeypress view/onkeypress;
       onkeydown view/onkeydown;
       onkeyup view/onkeyup;
       onfocus view/onfocus;
       onblur view/onblur;
       onchange view/onchange;
       readonly view/readonly;
       accesskey view/accesskey;
       onselect view/onselect;
     "
     i18n:domain="plone"
>
  <tal:if tal:define="
            up_id view/file_upload_id;
          "
          tal:condition="up_id"
  >
    <input name="${view/name}.file_upload_id"
           type="hidden"
           value="${up_id}"
    />
    <span>
      <tal:i18n i18n:translate="image_already_uploaded">Image already uploaded:</tal:i18n>
        ${view/value/filename}
    </span>
  </tal:if>
  <span tal:condition="python:exists and download_url and action=='nochange'">
    <a href="${download_url}">
      <img tal:replace="structure view/thumb_tag" />
    </a><br />
    <img src="${icon}"
         alt="${doc_type}"
         title="${filename}"
        tal:condition="icon"
    />
    <a href="${download_url}"
       tal:content="filename"
    >Filename</a>
    <span class="discreet">
      &mdash;<tal:doc_type condition="doc_type">
        <span tal:replace="doc_type"
              i18n:translate=""
        >ContentType</span>,</tal:doc_type>
      <span tal:define="
              sizekb view/file_size;
            "
            tal:replace="sizekb"
            i18n:translate=""
      >100</span>
    </span>
  </span>
  <tal:block condition="allow_nochange">
    <div class="form-check">
      <input class="form-check-input"
             checked="${python:'checked' if action == 'nochange' else None}"
             id="${view/id}-nochange"
             name="${view/name}.action"
             onclick="document.getElementById('${view/id}-input').disabled=true"
             type="radio"
             value="nochange"
      />
      <label class="form-check-label"
             for="${view/id}-nochange"
             i18n:translate="image_keep"
      >Keep existing image</label>
    </div>
    <div class="form-check"
         tal:condition="not:view/field/required"
    >
      <input class="form-check-input"
             checked="${python:'checked' if action == 'remove' else None}"
             name="${view/name}.action"
             id="${view/id}-remove"
             onlclick="document.getElementById('${view/id}-input').disabled=true"
             type="radio"
             value="remove"
      />
      <label class="form-check-label"
             for="${view/id}-remove"
             i18n:translate="image_remove"
      >Remove existing image</label>
    </div>

    <div class="form-check">
      <input class="form-check-input"
             checked="${python:'checked' if action == 'replace' else None}"
             name="${view/name}.action"
             id="${view/id}-replace"
             onclick="document.getElementById('${view/id}-input').disabled=false"
             type="radio"
             value="replace"
      />
      <label class="form-check-label"
             for="${view/id}-replace"
             i18n:translate="image_replace"
      >Replace with new image</label>
    </div>
  </tal:block>

  <input class="form-control"
         id="${view/id}-input"
         name="${view/name}"
         type="file"
         required="${python:view.required and 'required' or None}"
         size="${view/size}"
         disabled="${view/disabled|nothing}"
         maxlength="${view/maxlength}"
  />

  <script type="text/javascript"
          tal:condition="python:allow_nochange and action != 'replace'"
          tal:content="string:document.getElementById('${view/id}-input').disabled=true;"
  >
  </script>

</div>
